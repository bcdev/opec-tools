<?xml version="1.0" encoding="ISO-8859-1"?>
<?xml-stylesheet type="text/xsl" href="analysis-summary.xsl"?>

<analysisSummary>

    <performedAt>${performed_at}</performedAt>
    <recordCount>${record_count}</recordCount>

    <modelVariables>
        % for pair in pairs:
        <modelVariable>${pair[0]}</modelVariable>
        % endfor
    </modelVariables>

    <referenceVariables>
        % for pair in pairs:
        <referenceVariable>${pair[1]}</referenceVariable>
        % endfor
    </referenceVariables>

    <configuration>
        <property>
            <name>Maximum geographic delta</name>
            <value>${geo_delta}</value>
            <unit>degrees</unit>
        </property>
        <property>
            <name>Maximum time delta</name>
            <value>${time_delta}</value>
            <unit>seconds</unit>
        </property>
        <property>
            <name>Maximum depth delta</name>
            <value>${depth_delta}</value>
            <unit>meter</unit>
        </property>
        <property>
            <name>delta degrees of freedom (stddev)</name>
            <value>${ddof}</value>
        </property>
        <property>
            <name>alpha (percentile)</name>
            <value>${alpha}</value>
        </property>
        <property>
            <name>beta (percentile)</name>
            <value>${beta}</value>
        </property>
    </configuration>

    <statistics>
        % for pair in all_relative_stats:
        <statistic type="relative">
            <model_name>${pair[0]}</model_name>
            <ref_name>${pair[1]}</ref_name>
            <properties>
                % for var in pair[2].keys():
                <property>
                    <name>${var}</name>
                    <value>${pair[2][var]}</value>
                </property>
                % endfor
            </properties>
        </statistic>
        % endfor

        % for pair in all_model_stats:
        <statistic type="model">
            <model_name>${pair[0]}</model_name>
            <properties>
                % for var in pair[1].keys():
                <property>
                    <name>${var}</name>
                    <value>${pair[1][var]}</value>
                </property>
                % endfor
            </properties>
        </statistic>
        % endfor

        % for pair in all_ref_stats:
        <statistic type="reference">
            <ref_name>${pair[0]}</ref_name>
            <properties>
                % for var in pair[1].keys():
                <property>
                    <name>${var}</name>
                    <value>${pair[1][var]}</value>
                </property>
                % endfor
            </properties>
        </statistic>
        % endfor
    </statistics>

    <matchups>
        <variables>
            <% vars = [] %>
            % for matchup in matchups:
                % for var in matchup.values:
                    % if not var in vars:
                        <var>${var}</var>
                        <% vars.append(var) %>
                    % endif
                % endfor
            % endfor
        </variables>
        % for matchup in matchups:
        <matchup>
            <recordNumber>${matchup.reference_record.record_number}</recordNumber>
            <time>${matchup.spacetime_position[0]}</time>
            <depth>${matchup.spacetime_position[1]}</depth>
            <lat>${matchup.spacetime_position[2]}</lat>
            <lon>${matchup.spacetime_position[3]}</lon>
            <reference_time>${matchup.reference_record.time}</reference_time>
            <reference_depth>${matchup.reference_record.depth}</reference_depth>
            <reference_lat>${matchup.reference_record.lat}</reference_lat>
            <reference_lon>${matchup.reference_record.lon}</reference_lon>
            % for var in vars:
            <property>
                <name>${var}</name>
                <value>${matchup.values[var] if var in matchup.values else '--'}</value>
            </property>
            % endfor
        </matchup>
        % endfor
    </matchups>

% if write_taylor_diagrams and taylor_target_files is not None:
    % for taylor_target_file in taylor_target_files:
        <taylorDiagrams>
            <taylorDiagram>${taylor_target_file}</taylorDiagram>
        </taylorDiagrams>
    % endfor
% endif

% if write_target_diagram and target_diagram_file is not None:
    <targetDiagram>${target_diagram_file}</targetDiagram>
% endif

% if scatter_plot_files:
    % for scatter_plot in scatter_plot_files:
        <scatterPlots>
            <scatterPlot>${scatter_plot}</scatterPlot>
        </scatterPlots>
    % endfor
% endif

</analysisSummary>
